<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.innovate.cms.modules.qs.dao.menus.QxGroupCommentDao">
	
	<select id="getCommentList" resultType="com.innovate.cms.modules.qs.entity.menus.QxGroupComment">
		SELECT
			qgc.gcid,
			qgc.from_comment_uid AS "fromCommentUid",
			qgc.from_comment_name AS "fromCommentName",
			qgc.from_comment_img AS "fromCommentImg",
			qgc.`comment`,
			qgc.create_time AS "createTime"
		FROM
			qx_group_comment qgc
		WHERE
			qgc.gid = #{gid}
		ORDER BY
			create_time DESC
		LIMIT 20
	</select>
	
	<select id="getMoreComments" resultType="com.innovate.cms.modules.qs.entity.menus.QxGroupComment">
		SELECT
			qgc.gcid,
			qgc.from_comment_uid AS "fromCommentUid",
			qgc.from_comment_name AS "fromCommentName",
			qgc.from_comment_img AS "fromCommentImg",
			qgc.`comment`,
			qgc.create_time AS "createTime"
		FROM
			qx_group_comment qgc
		WHERE
			qgc.gid = #{gid}
		AND qgc.gcid &lt; #{gcid}
		ORDER BY
			create_time DESC
		LIMIT 20
	</select>
	
	<select id="getAllNewCommentList" resultType="com.innovate.cms.modules.qs.entity.menus.QxGroupComment">
		SELECT
			qgc.gcid,
			qgc.from_comment_uid AS "fromCommentUid",
			qgc.from_comment_name AS "fromCommentName",
			qgc.from_comment_img AS "fromCommentImg",
			qgc.`comment`,
			qgc.create_time AS "createTime"
		FROM
			qx_group_comment qgc
		WHERE
			qgc.gid = #{gid}
		AND qgc.gcid &gt; #{gcid}
		ORDER BY
			create_time DESC
	</select>
	
	<insert id="saveComment" useGeneratedKeys="true" keyProperty="gcid" >
		INSERT INTO qx_group_comment(
			gid,
			from_comment_uid,
			from_comment_name,
			from_comment_img,
			comment,
			create_time
		) VALUES (
			#{gid},
			#{fromCommentUid},
			#{fromCommentName},
			#{fromCommentImg},
			#{comment},
			#{createTime}
		)
	</insert>
	
	<update id="updateCommentNum">
		UPDATE qx_group_statistic
		SET commentNum = commentNum + 1
		WHERE gid = #{gid}
	</update>
	
</mapper>