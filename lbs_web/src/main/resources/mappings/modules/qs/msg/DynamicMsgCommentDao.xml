<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.innovate.cms.modules.qs.dao.msg.DynamicMsgCommentDao">

	<select id="get" resultType="DynamicMsgComment">

	</select>

	<select id="findList" resultType="DynamicMsgComment">

	</select>


	<insert id="insert">


	</insert>


	<select id="latestCommentList" resultType="DynamicMsgComment">
		SELECT
			c.cid,
			c.uid,
			c.headimgurl,
			c.content,
			c.comment_type AS "commentType",
			c.reply_uid AS "replyUid",
			c.reply_name AS "replyName",
			c.create_time AS "createTime"
		FROM
			dynamic_msg_comment c
		WHERE
			c.mid=#{mid}
		ORDER BY
			c.cid DESC
		LIMIT 20
	</select>
	<select id="upCommentList" resultType="DynamicMsgComment">
		SELECT
			c.cid,
			c.uid,
			c.headimgurl,
			c.content,
			c.comment_type AS "commentType",
			c.reply_uid AS "replyUid",
			c.reply_name AS "replyName",
			c.create_time AS "createTime"
		FROM
			dynamic_msg_comment c
		WHERE
			c.mid=1 AND
			c.cid &lt; #{cid}
		ORDER BY
			c.cid DESC
		LIMIT 20
	</select>

	
	<insert id="saveComment">
		INSERT INTO dynamic_msg_comment (
			mid,
			uid,
			headimgurl,
			content,
			comment_type,
			reply_uid,
			reply_name
		) SELECT
			#{mid},
			u.uid,
			u.headimgurl,
			#{content},
			#{commentType},
			#{replyUid},
			#{replyName}
		FROM
			system_user AS u
		WHERE
			u.uid = #{uid}
	</insert>
	
	<insert id="saveQxTagUserByuidgid">
		INSERT IGNORE INTO qx_tag_user (uid, tagId, tagName) SELECT
		#{uid} AS "uid",
		g.tagId AS "tagId",
		g.tagName AS "tagName"
		FROM
		qx_tag_group g
		WHERE
		g.gid = #{gid} ON DUPLICATE KEY UPDATE nums = nums + 1;

	</insert>



	<select id="findByUid" resultType="com.innovate.cms.modules.qs.entity.tag.QxTagToJson">
		SELECT
		q.tagId AS 'tagId',
		q.tagName AS "tagName"
		FROM
		qx_tag_user q
		WHERE
		uid = #{uid}
	</select>


</mapper>