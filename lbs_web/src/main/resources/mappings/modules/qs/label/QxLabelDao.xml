<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.innovate.cms.modules.qs.dao.label.QxLabelDao">


	<select id="getOptionLabel" resultType="com.innovate.cms.modules.qs.entity.label.OptionLabel">
		SELECT
			qqo.qid,
			qqo.seq_id AS "seqId",
			qqo.label_id AS "labelId",
			qltl.label_name AS "labelName",
			qltl.parent_id AS "parentId"
		FROM
			qx_questions_option qqo,
			qx_questions qq,
			qx_label_third_level qltl
		WHERE
			qqo.qid = qq.qid
		AND qqo.label_id = qltl.label_id
		AND qq.gid = #{gid}
		ORDER BY
			qqo.qid
	</select>

	<select id="getResultPageLabel" resultType="com.innovate.cms.modules.qs.entity.label.ResultLabel">
		SELECT
			qqr.results_tag AS "resultsTag",
			qqr.label_id AS "labelId",
			qltl.label_name AS "labelName",
			qltl.parent_id AS "parentId"
		FROM
			qx_questions_results qqr,
			qx_label_third_level qltl
		WHERE
			qqr.label_id = qltl.label_id
		AND qqr.gid = #{gid}
	</select>

	<insert id="saveOrUpdate">
		INSERT INTO qx_label_user
		(uid, parent_id, label_id, label_name, create_time)
		VALUES
		<foreach collection="list" index="index" item="item"
			separator=",">
			(#{item.uid}, #{item.parentId}, #{item.labelId}, #{item.labelName}, NOW())
		</foreach>
		ON DUPLICATE KEY UPDATE
		label_id = VALUES(label_id),
		label_name = VALUES(label_name)
	</insert>
</mapper>