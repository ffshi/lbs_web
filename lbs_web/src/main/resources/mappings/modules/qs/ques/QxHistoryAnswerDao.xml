<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.innovate.cms.modules.qs.dao.ques.QxHistoryAnswerDao">

	<select id="get" resultType="QxHistoryAnswer">
	</select>
	
	<select id="findList" resultType="QxHistoryAnswer">
	</select>
	
	<select id="findAllList" resultType="QxHistoryAnswer">	
	</select>
	
	<insert id="insert">	
	</insert>
	
	<insert id="addHistoryAnswer">	
		INSERT INTO `qx_history_answer`(
			`uid`,
			`gid`,
			`qid`,
			`answer`
		)
		VALUES
		(
			#{uid},
			#{gid},
			#{qid},
			#{answer}
		)
	</insert>
	
	
	<select id="getMatchResult" resultType="java.lang.String">
		SELECT
		    ROUND(
		        (
		            SELECT
		                count(1)
		            FROM
		                (
		                    SELECT
		                        *
		                    FROM
		                        qx_history_answer AS h
		                    WHERE
		                        h.uid = #{uid}
		                    AND h.gid = #{gid}
		                ) AS t1,
		                (
		                    SELECT
		                        *
		                    FROM
		                        qx_history_answer AS h
		                    WHERE
		                        h.uid =  #{fuid}
		                    AND h.gid =  #{gid}
		                ) AS t2
		            WHERE
		                t1.qid = t2.qid
		            AND t1.answer = t2.answer
		        ) / (
		            SELECT
		                count(1)
		            FROM
		                qx_history_answer AS h
		            WHERE
		                h.uid = #{uid}
		            AND h.gid = #{gid}
		        ),
		        2
		    )
	</select>
	
</mapper>