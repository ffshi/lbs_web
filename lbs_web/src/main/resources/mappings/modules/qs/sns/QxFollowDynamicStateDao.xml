<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.innovate.cms.modules.qs.dao.sns.QxFollowDynamicStateDao">
	
	<select id="getFollowDynamicStateList" resultType="com.innovate.cms.modules.data.entity.FollowDynamicStateToJson">
		SELECT
			qfds.dsid,
			qfds.uid,
			qf.follow_name AS "nickname",
			qf.follow_img AS "headimgurl",
			qfds.gid,
			qfds.group_name AS "groupName",
			qfds.group_description AS "groupDescription",
			qfds.small_icon AS "smallIcon",
			qfds.template_tag AS "templateTag",
			qfds.state,
			qfds.create_time AS "createTime"
		FROM
			qx_follow_dynamic_state qfds,
			qx_follow qf
		WHERE
			qf.uid = #{uid}
		AND qf.del_flag = "0"
		AND qfds.uid = qf.follow_uid
		ORDER BY
			qfds.dsid DESC
		LIMIT 20
	</select>

	<select id="showMoreDynamicStates" resultType="com.innovate.cms.modules.data.entity.FollowDynamicStateToJson">
		SELECT
			qfds.dsid,
			qfds.uid,
			qf.follow_name AS "nickname",
			qf.follow_img AS "headimgurl",
			qfds.gid,
			qfds.group_name AS "groupName",
			qfds.group_description AS "groupDescription",
			qfds.small_icon AS "smallIcon",
			qfds.template_tag AS "templateTag",
			qfds.state,
			qfds.create_time AS "createTime"
		FROM
			qx_follow_dynamic_state qfds,
			qx_follow qf
		WHERE
			qf.uid = #{uid}
		AND qf.del_flag = "0"
		AND qfds.uid = qf.follow_uid
		AND qfds.dsid &lt; #{dsid}
		ORDER BY
			qfds.dsid DESC
		LIMIT 20
	</select>

	<select id="refreshDynamicStates" resultType="com.innovate.cms.modules.data.entity.FollowDynamicStateToJson">
		SELECT
			qfds.dsid,
			qfds.uid,
			qf.follow_name AS "nickname",
			qf.follow_img AS "headimgurl",
			qfds.gid,
			qfds.group_name AS "groupName",
			qfds.group_description AS "groupDescription",
			qfds.small_icon AS "smallIcon",
			qfds.template_tag AS "templateTag",
			qfds.state,
			qfds.create_time AS "createTime"
		FROM
			qx_follow_dynamic_state qfds,
			qx_follow qf
		WHERE
			qf.uid = #{uid}
		AND qf.del_flag = "0"
		AND qfds.uid = qf.follow_uid
		AND qfds.dsid &gt; #{dsid}
		ORDER BY
			qfds.dsid DESC
	</select>
	
	<select id="getFootprintList" resultType="com.innovate.cms.modules.data.entity.FollowDynamicStateToJson">
		SELECT
			qfds.dsid,
			qfds.uid,
			qfds.gid,
			qfds.group_name AS "groupName",
			qfds.group_description AS "groupDescription",
			qfds.small_icon AS "smallIcon",
			qfds.template_tag AS "templateTag",
			qfds.create_time AS "createTime"
		FROM
			qx_follow_dynamic_state qfds
		WHERE
			qfds.uid = #{uid}
		AND qfds.state != 1
		ORDER BY
			qfds.dsid DESC
		LIMIT 20
	</select>
	
	<select id="showMoreFootprints" resultType="com.innovate.cms.modules.data.entity.FollowDynamicStateToJson">
		SELECT
			qfds.dsid,
			qfds.uid,
			qfds.gid,
			qfds.group_name AS "groupName",
			qfds.group_description AS "groupDescription",
			qfds.small_icon AS "smallIcon",
			qfds.template_tag AS "templateTag",
			qfds.create_time AS "createTime"
		FROM
			qx_follow_dynamic_state qfds
		WHERE
			qfds.uid = #{uid}
		AND qfds.state != 1
		AND qfds.dsid &lt; #{dsid}
		ORDER BY
			qfds.dsid DESC
		LIMIT 20
	</select>
	
	<select id="refreshFootprints" resultType="com.innovate.cms.modules.data.entity.FollowDynamicStateToJson">
		SELECT
			qfds.dsid,
			qfds.uid,
			qfds.gid,
			qfds.group_name AS "groupName",
			qfds.group_description AS "groupDescription",
			qfds.small_icon AS "smallIcon",
			qfds.template_tag AS "templateTag",
			qfds.create_time AS "createTime"
		FROM
			qx_follow_dynamic_state qfds
		WHERE
			qfds.uid = #{uid}
		AND qfds.state != 1
		AND qfds.dsid &gt; #{dsid}
		ORDER BY
			qfds.dsid DESC
	</select>
	
	<insert id="saveCreateGroupDynamicState">
		INSERT INTO qx_follow_dynamic_state (
			uid,
			gid,
			group_name,
			template_tag,
			state
		)
		VALUES
			(#{uid}, #{gid}, #{groupName}, 0, 1)
	</insert>
	
	<insert id="saveGroupZeroDynamicState">
		INSERT INTO qx_follow_dynamic_state (
			uid,
			gid,
			group_name,
			template_tag,
			state
		) SELECT
			#{uid},
			gid,
			group_name,
			template_tag,
			2
		FROM
			qx_groups
		WHERE
			gid = #{gid}
		AND template_tag = #{templateTag}
		AND del_flag = "0"
	</insert>
	
	<insert id="saveGroupFourDynamicState">
		INSERT INTO qx_follow_dynamic_state (
			uid,
			gid,
			group_name,
			group_description,
			small_icon,
			template_tag,
			state
		) SELECT
			#{uid},
			gid,
			group_name,
			group_description,
			small_icon,
			template_tag,
			3
		FROM
			qx_groups
		WHERE
			gid = #{gid}
		AND template_tag = #{templateTag}
		AND del_flag = "0"
	</insert>
</mapper>